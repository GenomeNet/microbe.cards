<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ microbe.binomial_name }}</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; padding: 20px; }
        h1, h2, h3 { color: #333; }
        .section { margin-bottom: 20px; }
        .phenotype {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }
        .phenotype h3 { margin-top: 0; color: #0066cc; }
        .phenotype p { margin: 5px 0; }
        .prediction { margin-top: 10px; }
        .prediction h4 { margin-bottom: 5px; }
        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.9em;
            font-weight: bold;
            margin-right: 5px;
        }
        .tag-true { background-color: #90EE90; color: #006400; }
        .tag-false { background-color: #FFA07A; color: #8B0000; }
        .tag-other { background-color: #E0E0E0; color: #333; }
    </style>
</head>
<body>
    <h1>{{ microbe.binomial_name }}</h1>
    
    <div class="section">
        <h2>Taxonomy</h2>
        <p>Superkingdom: {{ microbe.taxonomy.superkingdom }}</p>
        <p>Phylum: {{ microbe.taxonomy.phylum }}</p>
        <p>Class: {{ microbe.taxonomy.class_name }}</p>
        <p>Order: {{ microbe.taxonomy.order }}</p>
        <p>Family: {{ microbe.taxonomy.family }}</p>
        <p>Genus: {{ microbe.taxonomy.genus }}</p>
        <p>Species: {{ microbe.taxonomy.species }}</p>
    </div>

    <div class="section">
        <h2>NCBI ID</h2>
        <p>{{ microbe.ncbi_id }}</p>
    </div>

    <div class="section">
        <h2>Alternative Names</h2>
        <ul>
        {% for name in microbe.alternative_names %}
            <li>{{ name }}</li>
        {% empty %}
            <li>No alternative names</li>
        {% endfor %}
        </ul>
    </div>

    <div class="section">
        <h2>Phenotypes</h2>
        {% for phenotype in phenotypes %}
            <div class="phenotype">
                <h3>{{ phenotype.definition.name }}</h3>
                {% if phenotype.value %}
                    <p><strong>Ground Truth Value:</strong> 
                        {% if phenotype.definition.data_type == 'boolean' %}
                            <span class="tag {% if phenotype.value == 'TRUE' or phenotype.value == 'true' %}tag-true{% elif phenotype.value == 'FALSE' or phenotype.value == 'false' %}tag-false{% else %}tag-other{% endif %}">
                                {{ phenotype.value|upper }}
                            </span>
                        {% else %}
                            <span class="tag tag-other">{{ phenotype.value }}</span>
                        {% endif %}
                    </p>
                {% else %}
                    <p><strong>Ground Truth Value:</strong> Not available</p>
                {% endif %}
                <p><strong>Data Type:</strong> {{ phenotype.definition.data_type }}</p>
                <p><strong>Description:</strong> {{ phenotype.definition.description }}</p>
                {% if phenotype.definition.allowed_values %}
                    <p><strong>Allowed Values:</strong> 
                    {% for value in phenotype.definition.allowed_values %}
                        <span class="tag tag-other">{{ value }}</span>
                    {% endfor %}
                    </p>
                {% endif %}
                
                <h4>Predictions:</h4>
                {% for prediction in predictions %}
                    {% for predicted_phenotype in prediction.predicted_phenotypes.all %}
                        {% if predicted_phenotype.definition.name == phenotype.definition.name %}
                            <div class="prediction">
                                <h4>{{ prediction.model }}</h4>
                                <p><strong>Inference Date:</strong> {{ prediction.inference_date_time }}</p>
                                <p><strong>Predicted Value:</strong> 
                                    {% if phenotype.definition.data_type == 'boolean' %}
                                        <span class="tag {% if predicted_phenotype.value == 'TRUE' or predicted_phenotype.value == 'true' %}tag-true{% elif predicted_phenotype.value == 'FALSE' or predicted_phenotype.value == 'false' %}tag-false{% else %}tag-other{% endif %}">
                                            {{ predicted_phenotype.value|upper }}
                                        </span>
                                    {% else %}
                                        <span class="tag tag-other">{{ predicted_phenotype.value }}</span>
                                    {% endif %}
                                </p>
                            </div>
                        {% endif %}
                    {% endfor %}
                {% empty %}
                    <p>No predictions available</p>
                {% endfor %}
            </div>
        {% empty %}
            <p>No phenotypes available</p>
        {% endfor %}
    </div>

    <div class="section">
        <h2>Genome Info</h2>
        <p>FTP Path: {{ microbe.ftp_path|default:"N/A" }}</p>
        <p>FASTA File: {{ microbe.fasta_file|default:"N/A" }}</p>
    </div>

    <a href="{% url 'index' %}">Back to Microbe List</a>
</body>
</html>
